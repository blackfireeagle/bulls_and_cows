import tkinter as tk
from tkinter import messagebox
import random

class BullsAndCowsGame:
    def __init__(self, root):
        self.root = root
        self.root.title("Игра: Быки и Коровы")

        self.secret_number = ""
        self.attempts = []

        self.create_widgets()

    def create_widgets(self):
        tk.Label(self.root, text="Введите количество символов:").pack(pady=5)
        self.length_entry = tk.Entry(self.root, width=4)
        self.length_entry.pack(pady=5)

        tk.Label(self.root, text="Выберите систему счисления:").pack(pady=5)
        self.base_var = tk.StringVar(value="10")
        tk.Radiobutton(self.root, text="Десятичная (2-10)", variable=self.base_var, value="10").pack(pady=5)
        tk.Radiobutton(self.root, text="Шестнадцатеричная (2-16)", variable=self.base_var, value="16").pack(pady=5)

        tk.Button(self.root, text="Начать игру", command=self.start_game).pack(pady=10)

        self.attempt_entry = tk.Entry(self.root, width=10)
        self.attempt_entry.pack(pady=5)
        self.attempt_entry.bind('<Return>', self.play)

        tk.Label(self.root, text="Предыдущие попытки:").pack(pady=5)
        self.attempts_display = tk.Text(self.root, height=10, width=40, state='disabled')
        self.attempts_display.pack(pady=5)

        self.result_msg = tk.Message(width=400, padx=10, pady=5, text='')
        self.result_msg.pack(pady=5)

        self.attempt_entry.focus()

    def start_game(self):
        try:
            length = int(self.length_entry.get())
            if self.base_var.get() == "10":
                if not (2 <= length <= 10):
                    raise ValueError
                self.secret_number = ''.join(random.choices('0123456789', k=length))
            else:
                if not (2 <= length <= 16):
                    raise ValueError
                self.secret_number = ''.join(random.choices('0123456789abcdef', k=length))

            self.attempts = []
            self.attempts_display.config(state='normal')
            self.attempts_display.delete('1.0', tk.END)
            self.attempts_display.config(state='disabled')
            self.result_msg.config(text='Сыграем! Введите вашу попытку:')
            self.length_entry.config(state='disabled')
            self.base_var.set("10" if self.base_var.get() == "10" else "16")

        except ValueError:
            messagebox.showerror("Ошибка", "Пожалуйста, введите корректное количество символов!")

    def play(self, event):
        attempt = self.attempt_entry.get().lower()
        if attempt == "я сдаюсь":
            messagebox.showinfo("Сдача", f"Вы сдались. Загаданное число: {self.secret_number}")
            self.root.quit()
            return

        if len(attempt) != len(self.secret_number):
            messagebox.showwarning("Ошибка", f"Должно быть {len(self.secret_number)} символов!")
            return

        bulls, cows = self.calculate_score(attempt)
        self.attempts.append((attempt, bulls, cows))
        self.update_attempts_display()

        if bulls == len(self.secret_number):
            messagebox.showinfo("Победа", "Поздравляю! Вы победили!")
            self.root.quit()
        else:
            self.result_msg.config(text=f'Попытка: {attempt} - {bulls} быка(ов), {cows} коровы(ы)')

        self.attempt_entry.delete(0, tk.END)

    def calculate_score(self, attempt):
        bulls = sum(a == b for a, b in zip(attempt, self.secret_number))
        cows = sum(min(attempt.count(x), self.secret_number.count(x)) for x in set(attempt)) - bulls
        return bulls, cows

    def update_attempts_display(self):
        self.attempts_display.config(state='normal')
        self.attempts_display.delete('1.0', tk.END)
        for attempt, bulls, cows in self.attempts:
            self.attempts_display.insert(tk.END, f"Попытка: {attempt} - {bulls} быка(ов), {cows} коровы(ы)\n")
        self.attempts_display.config(state='disabled')

if __name__ == "__main__":
    root = tk.Tk()
    game = BullsAndCowsGame(root)
    root.mainloop()
